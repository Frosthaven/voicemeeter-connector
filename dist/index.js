var e=require("ffi-napi"),t=require("ref-array-napi"),r=require("winreg");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i,o,a,c,u,s,l=n(e),d=n(t),m=n(r),f=d.default("char"),v=d.default("long"),p=d.default("float"),V=function(){function e(){var e=this;this.isInitialised=!1,this.isConnected=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.eventPool=[],this.connect=function(){if(!e.isInitialised)throw new Error("Await the initialisation before connect");if(!e.isConnected){if(0===i.VBVMR_Login())return e.isConnected=!0,e.type=e.getVoicemeeterType(),e.version=e.getVoicemeeterVersion(),void setInterval(e.checkPropertyChange,10);throw e.isConnected=!1,new Error("Connection failed")}},this.disconnect=function(){if(!e.isConnected)throw new Error("Not connected ");try{if(0===i.VBVMR_Logout())return void(e.isConnected=!1);throw new Error("Disconnect failed")}catch(e){throw new Error("Disconnect failed")}},this.updateDeviceList=function(){if(!e.isConnected)throw new Error("Not connected ");e.outputDevices=[],e.inputDevices=[];for(var t=i.VBVMR_Output_GetDeviceNumber(),r=0;r<t;r++){var n=new f(256),o=new f(256),a=new v(1);i.VBVMR_Output_GetDeviceDescA(r,a,o,n),e.outputDevices.push({name:String.fromCharCode.apply(String,o.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode.apply(String,n.toArray()).replace(/\u0000+$/g,""),type:a[0]})}for(var c=i.VBVMR_Input_GetDeviceNumber(),u=0;u<c;u++){var s=new f(256),l=new f(256),d=new v(1);i.VBVMR_Input_GetDeviceDescA(u,d,l,s),e.inputDevices.push({name:String.fromCharCode.apply(String,l.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode.apply(String,s.toArray()).replace(/\u0000+$/g,""),type:d[0]})}},this.isParametersDirty=function(){return i.VBVMR_IsParametersDirty()},this.getBusParameter=function(t,r){return e.getParameter("Bus",t,r)},this.getStripParameter=function(t,r){return e.getParameter("Strip",t,r)},this.setStripParameter=function(t,r,n){return e.setParameter("Strip",t,r,n)},this.setBusParameter=function(t,r,n){return e.setParameter("Bus",t,r,n)},this.attachChangeEvent=function(t){e.eventPool.push(t)},this.checkPropertyChange=function(){1===e.isParametersDirty()&&e.eventPool.forEach(function(e){e()})},this.getVoicemeeterType=function(){var e=new v(1);if(0!==i.VBVMR_GetVoicemeeterType(e))throw new Error("running failed");switch(e[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=function(){var e=new v(1);if(0!==i.VBVMR_GetVoicemeeterVersion(e))throw new Error("running failed");return e},this.getParameter=function(t,r,n){var o=t+"["+r+"]."+n;if(!e.isConnected)throw new Error("Not correct connected ");var a=Buffer.alloc(o.length+1);a.write(o);var c=null;return["Label","FadeTo","FadeBy","AppGain","AppMute","device.name"].indexOf(n)>-1?(c=new f(512),i.VBVMR_GetParameterStringA(a,c),String.fromCharCode.apply(null,c).split("").filter(function(e){return"\0"!==e}).join("")):(c=new p(1),i.VBVMR_GetParameterFloat(a,c),c[0])},this.setParameter=function(t,r,n,o){if(!e.isConnected)throw new Error("Not connected ");var a=t+"["+r+"]."+n+"="+o+";",c=Buffer.alloc(a.length+1);return c.fill(0),c.write(a),i.VBVMR_SetParameters(c),new Promise(function(e){return setTimeout(e,200)})},this.sendCommand=function(t,r){if(!e.isConnected)throw new Error("Not connected ");var n="Command."+t+"="+r+";",o=Buffer.alloc(n.length+1);return o.fill(0),o.write(n),i.VBVMR_SetParameters(o),new Promise(function(e){return setTimeout(e,200)})}}var t;return e.init=function(){try{return Promise.resolve(function(){try{var e=new m.default({hive:m.default.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return Promise.resolve(new Promise(function(t){e.values(function(e,r){if(e)throw new Error(e);var n=r.find(function(e){return"UninstallString"===e.name}).value,i=n.lastIndexOf("\\");t(n.slice(0,i))})}))}catch(e){return Promise.reject(e)}}()).then(function(t){return new Promise(function(r){o||(o=new e),i=l.default.Library(t+"/VoicemeeterRemote64.dll",{VBVMR_Login:["long",[]],VBVMR_Logout:["long",[]],VBVMR_RunVoicemeeter:["long",["long"]],VBVMR_IsParametersDirty:["long",[]],VBVMR_GetParameterFloat:["long",[f,p]],VBVMR_GetParameterStringA:["long",[f,f]],VBVMR_SetParameters:["long",[f]],VBVMR_Output_GetDeviceNumber:["long",[]],VBVMR_Output_GetDeviceDescA:["long",["long",v,f,f]],VBVMR_Input_GetDeviceNumber:["long",[]],VBVMR_Input_GetDeviceDescA:["long",["long",v,f,f]],VBVMR_GetVoicemeeterType:["long",[v]],VBVMR_GetVoicemeeterVersion:["long",[v]]}),o.isInitialised=!0,r(o)})})}catch(e){return Promise.reject(e)}},(t=[{key:"$outputDevices",get:function(){return this.outputDevices}},{key:"$inputDevices",get:function(){return this.inputDevices}},{key:"$version",get:function(){return this.version}},{key:"$type",get:function(){return this.type}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,t),e}();!function(e){e.Mono="Mono",e.Mute="Mute",e.Solo="Solo",e.MC="MC",e.Gain="Gain",e.Pan_x="Pan_x",e.Pan_y="Pan_y",e.Color_x="Color_x",e.Color_y="Color_y",e.fx_x="fx_x",e.fx_y="fx_y",e.Audibility="Audibility",e.Comp="Comp",e.Gate="Gate",e.Karaoke="Karaoke",e.Limit="Limit",e.EQGain1="EQGain1",e.EQGain2="EQGain2",e.EQGain3="EQGain3",e.Label="Label",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Reverb="Reverb",e.Delay="Delay",e.Fx1="Fx1",e.Fx2="Fx2",e.PostReverb="PostReverb",e.PostDelay="PostDelay",e.PostFx1="PostFx1",e.PostFx2="PostFx2",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(a||(a={})),(s=c||(c={})).Mono="Mono",s.Mute="Mute",s.EQ="EQ.on",s.EQAB="EQ.AB",s.Gain="Gain",s.Label="Label",s.ModeNormal="mode.normal",s.ModeAmix="mode.Amix",s.ModeBmix="mode.Bmix",s.ModeRepeat="mode.Repeat",s.ModeComposite="mode.Composite",s.ModeTVMix="mode.TVMix",s.ModeUpMix21="mode.UpMix21",s.ModeUpMix41="mode.UpMix41",s.ModeUpMix61="mode.UpMix61",s.ModeCenterOnly="mode.CenterOnly",s.ModeLFEOnly="mode.LFEOnly",s.FadeTo="FadeTo",s.FadeBy="FadeBy",s.Sel="Sel",s.ReturnReverb="ReturnReverb",s.ReturnDelay="ReturnDelay",s.ReturnFx1="ReturnFx1",s.ReturnFx2="ReturnFx2",s.Monitor="Monitor",s.DeviceName="device.name",s.DeviceSR="device.sr",s.DeviceWDM="device.wdm",s.DeviceKS="device.ks",s.DeviceMME="device.mme",s.DeviceASIO="device.asio",function(e){e.Shutdown="Shutdown",e.Show="Show",e.Restart="Restart",e.Eject="Eject",e.Reset="Reset",e.Save="Save",e.Load="Load"}(u||(u={}));var h=a;exports.BusProperties=c,exports.InterfaceTypes={strip:0,bus:1},exports.StripProperties=h,exports.Voicemeeter=V,exports.types={__proto__:null};
//# sourceMappingURL=index.js.map
