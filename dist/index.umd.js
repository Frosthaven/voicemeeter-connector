!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ffi-napi"),require("ref-array-napi"),require("winreg")):"function"==typeof define&&define.amd?define(["exports","ffi-napi","ref-array-napi","winreg"],t):t((e||self).voicemeeterConnector={},e.ffiNapi,e.refArrayNapi,e.winreg)}(this,function(e,t,n,r){function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o,a,u,c,l,s,f,m,p,h,d,P,v,y,B,g,M,C,V,S=i(t),w=i(n),A=i(r);!function(e){e.App="[app]",e.Bus="[bus]",e.Button="[button]",e.Cell="[cell]",e.Channel="[channel]",e.Strip="[strip]"}(o||(o={})),function(e){e.Mono="Mono",e.Mute="Mute",e.Solo="Solo",e.MC="MC",e.Gain="Gain",e.Pan_x="Pan_x",e.Pan_y="Pan_y",e.Color_x="Color_x",e.Color_y="Color_y",e.fx_x="fx_x",e.fx_y="fx_y",e.Audibility="Audibility",e.Comp="Comp",e.Gate="Gate",e.Karaoke="Karaoke",e.Limit="Limit",e.EQGain1="EQGain1",e.EQGain2="EQGain2",e.EQGain3="EQGain3",e.Label="Label",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Reverb="Reverb",e.Delay="Delay",e.Fx1="Fx1",e.Fx2="Fx2",e.PostReverb="PostReverb",e.PostDelay="PostDelay",e.PostFx1="PostFx1",e.PostFx2="PostFx2",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(a||(a={})),function(e){e.GainLayer="GainLayer[bus]"}(u||(u={})),function(e){e.StripAppGain="AppGain",e.StripAppMute="AppMute",e.StripAppGainPartialMatch="App[app].Gain",e.StripAppMutePartialMatch="App[app].Mute"}(c||(c={})),function(e){e.Mono="Mono",e.Mute="Mute",e.EQ="EQ.on",e.EQAB="EQ.AB",e.Gain="Gain",e.Label="Label",e.ModeNormal="mode.normal",e.ModeAmix="mode.Amix",e.ModeBmix="mode.Bmix",e.ModeRepeat="mode.Repeat",e.ModeComposite="mode.Composite",e.ModeTVMix="mode.TVMix",e.ModeUpMix21="mode.UpMix21",e.ModeUpMix41="mode.UpMix41",e.ModeUpMix61="mode.UpMix61",e.ModeCenterOnly="mode.CenterOnly",e.ModeLFEOnly="mode.LFEOnly",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Sel="Sel",e.ReturnReverb="ReturnReverb",e.ReturnDelay="ReturnDelay",e.ReturnFx1="ReturnFx1",e.ReturnFx2="ReturnFx2",e.Monitor="Monitor",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(l||(l={})),(V=s||(s={})).EQChannelCellOn="EQ.channel[channel].cell[cell].on",V.EQChannelCellType="EQ.channel[channel].cell[cell].type",V.EQChannelCellF="EQ.channel[channel].cell[cell].f",V.EQChannelCellGain="EQ.channel[channel].cell[cell].gain",V.EQChannelCellQ="EQ.channel[channel].cell[cell].q",function(e){e.Shutdown="Shutdown",e.Show="Show",e.Restart="Restart",e.Eject="Eject",e.Reset="Reset",e.Save="Save",e.Load="Load",e.DialogShowVBANCHAT="DialogShow.VBANCHAT"}(f||(f={})),function(e){e.LoadBUSEQ="LoadBUSEQ[bus]",e.SaveBUSEQ="SaveBUSEQ[bus]"}(m||(m={})),function(e){e.ButtonState="Button[button].State",e.ButtonStateOnly="Button[button].StateOnly",e.ButtonTrigger="Button[button].Trigger"}(p||(p={})),function(e){e.ReverbOn="Reverb.On",e.ReverbAB="Reverb.AB",e.DelayOn="Delay.On",e.DelayAB="Delay.AB"}(h||(h={})),function(e){e.PostFaderComposite="PostFaderComposite",e.PostFxInsert="PostFxInsert"}(d||(d={})),function(e){e.Asio="asio[channel]",e.OutA2="OutA2[channel]",e.OutA3="OutA3[channel]",e.OutA4="OutA4[channel]",e.OutA5="OutA5[channel]"}(P||(P={})),function(e){e.Composite="composite[channel]"}(v||(v={})),function(e){e.Insert="insert[channel]"}(y||(y={})),function(e){e.SR="sr",e.ASIOSR="ASIOsr",e.BufferMME="buffer.mme",e.BufferWDM="buffer.wdm",e.BufferKS="buffer.ks",e.BufferASIO="buffer.asio",e.ModeExclusif="mode.exclusif",e.ModeSwift="mode.swift",e.MonitorOnSEL="MonitorOnSEL"}(B||(B={})),function(e){e.Delay="delay[bus]"}(g||(g={})),M||(M={}),C||(C={});var D,R,E=w.default("char"),_=w.default("long"),b=w.default("float"),x=function(){function e(){var e=this;this.isInitialised=!1,this.isConnected=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.eventPool=[],this.connect=function(){if(!e.isInitialised)throw new Error("Await the initialisation before connect");if(!e.isConnected){if(0===D.VBVMR_Login())return e.isConnected=!0,e.type=e.getVoicemeeterType(),e.version=e.getVoicemeeterVersion(),void setInterval(e.checkPropertyChange,10);throw e.isConnected=!1,new Error("Connection failed")}},this.disconnect=function(){if(!e.isConnected)throw new Error("Not connected ");try{if(0===D.VBVMR_Logout())return void(e.isConnected=!1);throw new Error("Disconnect failed")}catch(e){throw new Error("Disconnect failed")}},this.updateDeviceList=function(){if(!e.isConnected)throw new Error("Not connected ");e.outputDevices=[],e.inputDevices=[];for(var t=D.VBVMR_Output_GetDeviceNumber(),n=0;n<t;n++){var r=new E(256),i=new E(256),o=new _(1);D.VBVMR_Output_GetDeviceDescA(n,o,i,r),e.outputDevices.push({name:String.fromCharCode.apply(String,i.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode.apply(String,r.toArray()).replace(/\u0000+$/g,""),type:o[0]})}for(var a=D.VBVMR_Input_GetDeviceNumber(),u=0;u<a;u++){var c=new E(256),l=new E(256),s=new _(1);D.VBVMR_Input_GetDeviceDescA(u,s,l,c),e.inputDevices.push({name:String.fromCharCode.apply(String,l.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode.apply(String,c.toArray()).replace(/\u0000+$/g,""),type:s[0]})}},this.isParametersDirty=function(){return D.VBVMR_IsParametersDirty()},this.getStripParameter=function(t,n){return e.getParameter("Strip",t,n)},this.setStripParameter=function(t,n,r){return e.setParameter("Strip",t,n,r)},this.getBusParameter=function(t,n){return e.getParameter("Bus",t,n)},this.setBusParameter=function(t,n,r){return e.setParameter("Bus",t,n,r)},this.getStripGainLayerParameter=function(t,n){var r=u.GainLayer.replace(o.Bus,"["+n+"]");return e.getParameter("Strip",t,r)},this.setStripGainLayerParameter=function(t,n,r){var i=u.GainLayer.replace(o.Bus,"["+n+"]");return e.setParameter("Strip",t,i,r)},this.setStripAppParameter=function(t,n,r,i){return n.includes("[")?n=n.replace(o.App,"["+r+"]"):i='("'+r+'",'+i+")",e.setParameter("Strip",t,n,i)},this.getBusEQChannelCellParameter=function(t,n,r,i){return i=(i=i.replace(o.Channel,"["+n+"]")).replace(o.Cell,"["+r+"]"),e.getParameter("Bus",t,i)},this.setBusEQChannelCellParameter=function(t,n,r,i,a){return i=(i=i.replace(o.Channel,"["+n+"]")).replace(o.Cell,"["+r+"]"),e.setParameter("Bus",t,i,a)},this.getFXParameter=function(t){return e.getParameter("Fx",null,t)},this.setFXParameter=function(t,n){return e.setParameter("Fx",null,t,n)},this.getPatchParameter=function(t){return e.getParameter("Patch",null,t)},this.setPatchParamater=function(t,n){return e.setParameter("Patch",null,t,n)},this.getPatchChannelParameter=function(t,n){return n=n.replace(o.Channel,"["+t+"]"),e.getParameter("patch",null,n)},this.setPatchChannelParamater=function(t,n,r){return n=n.replace(o.Channel,"["+t+"]"),e.setParameter("patch",null,n,r)},this.getSystemParameter=function(t){return e.getParameter("Option",null,t)},this.setSystemParameter=function(t,n){return e.setParameter("Option",null,t,n)},this.getSystemBusDelayParameter=function(t,n){return n=n.replace(o.Bus,"["+t+"]"),e.getParameter("Option",null,n)},this.setSystemBusDelayParameter=function(t,n,r){return n=n.replace(o.Bus,"["+t+"]"),e.setParameter("Option",null,n,r)},this.setCommandParameter=function(t,n){if(!e.isConnected)throw new Error("Not connected ");var r="Command."+t+"="+n+";",i=Buffer.alloc(r.length+1);return i.fill(0),i.write(r),D.VBVMR_SetParameters(i),new Promise(function(e){return setTimeout(e,200)})},this.setCommandBusEQParamater=function(t,n,r){if(!e.isConnected)throw new Error("Not connected ");var i="Command."+(n=n.replace(o.Bus,"["+t+"]"))+"="+r+";",a=Buffer.alloc(i.length+1);return a.fill(0),a.write(i),D.VBVMR_SetParameters(a),new Promise(function(e){return setTimeout(e,200)})},this.setCommandButtonParameter=function(t,n,r){if(!e.isConnected)throw new Error("Not connected ");var i="Command."+(n=n.replace(o.Button,"["+t+"]"))+"="+r+";",a=Buffer.alloc(i.length+1);return a.fill(0),a.write(i),D.VBVMR_SetParameters(a),new Promise(function(e){return setTimeout(e,200)})},this.attachChangeEvent=function(t){e.eventPool.push(t)},this.checkPropertyChange=function(){1===e.isParametersDirty()&&e.eventPool.forEach(function(e){e()})},this.getVoicemeeterType=function(){var e=new _(1);if(0!==D.VBVMR_GetVoicemeeterType(e))throw new Error("running failed");switch(e[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=function(){var e=new _(1);if(0!==D.VBVMR_GetVoicemeeterVersion(e))throw new Error("running failed");return e},this.getParameter=function(t,n,r){var i=null!==n?t+"["+n+"]."+r:t+"."+r;if(!e.isConnected)throw new Error("Not correct connected ");var o=Buffer.alloc(i.length+1);o.write(i);var a=null;return["Label","FadeTo","FadeBy","AppGain","AppMute","device.name"].indexOf(r)>-1?(a=new E(512),D.VBVMR_GetParameterStringA(o,a),String.fromCharCode.apply(null,a).split("").filter(function(e){return"\0"!==e}).join("")):(a=new b(1),D.VBVMR_GetParameterFloat(o,a),a[0])},this.setParameter=function(t,n,r,i){if(!e.isConnected)throw new Error("Not connected ");var o=null!==n?t+"["+n+"]."+r+"="+i+";":t+"."+r+"="+i+";",a=Buffer.alloc(o.length+1);return a.fill(0),a.write(o),D.VBVMR_SetParameters(a),new Promise(function(e){return setTimeout(e,200)})}}var t;return e.init=function(){try{return Promise.resolve(function(){try{var e=new A.default({hive:A.default.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return Promise.resolve(new Promise(function(t){e.values(function(e,n){if(e)throw new Error(e);var r=n.find(function(e){return"UninstallString"===e.name}).value,i=r.lastIndexOf("\\");t(r.slice(0,i))})}))}catch(e){return Promise.reject(e)}}()).then(function(t){return new Promise(function(n){R||(R=new e),D=S.default.Library(t+"/VoicemeeterRemote64.dll",{VBVMR_Login:["long",[]],VBVMR_Logout:["long",[]],VBVMR_RunVoicemeeter:["long",["long"]],VBVMR_IsParametersDirty:["long",[]],VBVMR_GetParameterFloat:["long",[E,b]],VBVMR_GetParameterStringA:["long",[E,E]],VBVMR_SetParameters:["long",[E]],VBVMR_Output_GetDeviceNumber:["long",[]],VBVMR_Output_GetDeviceDescA:["long",["long",_,E,E]],VBVMR_Input_GetDeviceNumber:["long",[]],VBVMR_Input_GetDeviceDescA:["long",["long",_,E,E]],VBVMR_GetVoicemeeterType:["long",[_]],VBVMR_GetVoicemeeterVersion:["long",[_]]}),R.isInitialised=!0,n(R)})})}catch(e){return Promise.reject(e)}},(t=[{key:"$outputDevices",get:function(){return this.outputDevices}},{key:"$inputDevices",get:function(){return this.inputDevices}},{key:"$version",get:function(){return this.version}},{key:"$type",get:function(){return this.type}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}(),G=a,O=l,F=h,Q=f,L=d,T=P,I=v,N=y,k=B,U=g,j=M,$=C;e.BusEQChannelCellProperties=s,e.BusProperties=O,e.CommandProperties=Q,e.FXProperties=F,e.InterfaceTypes={strip:0,bus:1},e.PatchChannelProperties=T,e.PatchCompositeProperties=I,e.PatchInsertProperties=N,e.PatchProperties=L,e.RecorderProperties=j,e.StripProperties=G,e.SystemBusDelayProperties=U,e.SystemProperties=k,e.VBANProperties=$,e.Voicemeeter=x,e.types={__proto__:null}});
//# sourceMappingURL=index.umd.js.map
