import e from"ffi-napi";import t from"ref-array-napi";import r from"winreg";var n,i,o,a,s,l,c,u,h,p,m,P,d,B,g,f,C,y;!function(e){e.App="[app]",e.Bus="[bus]",e.Button="[button]",e.Cell="[cell]",e.Channel="[channel]",e.Strip="[strip]"}(n||(n={})),function(e){e.Mono="Mono",e.Mute="Mute",e.Solo="Solo",e.MC="MC",e.Gain="Gain",e.Pan_x="Pan_x",e.Pan_y="Pan_y",e.Color_x="Color_x",e.Color_y="Color_y",e.fx_x="fx_x",e.fx_y="fx_y",e.Audibility="Audibility",e.Comp="Comp",e.Gate="Gate",e.Karaoke="Karaoke",e.Limit="Limit",e.EQGain1="EQGain1",e.EQGain2="EQGain2",e.EQGain3="EQGain3",e.Label="Label",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Reverb="Reverb",e.Delay="Delay",e.Fx1="Fx1",e.Fx2="Fx2",e.PostReverb="PostReverb",e.PostDelay="PostDelay",e.PostFx1="PostFx1",e.PostFx2="PostFx2",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(i||(i={})),function(e){e.GainLayer="GainLayer[bus]"}(o||(o={})),function(e){e.StripAppGain="AppGain",e.StripAppMute="AppMute",e.StripAppGainPartialMatch="App[app].Gain",e.StripAppMutePartialMatch="App[app].Mute"}(a||(a={})),function(e){e.Mono="Mono",e.Mute="Mute",e.EQ="EQ.on",e.EQAB="EQ.AB",e.Gain="Gain",e.Label="Label",e.ModeNormal="mode.normal",e.ModeAmix="mode.Amix",e.ModeBmix="mode.Bmix",e.ModeRepeat="mode.Repeat",e.ModeComposite="mode.Composite",e.ModeTVMix="mode.TVMix",e.ModeUpMix21="mode.UpMix21",e.ModeUpMix41="mode.UpMix41",e.ModeUpMix61="mode.UpMix61",e.ModeCenterOnly="mode.CenterOnly",e.ModeLFEOnly="mode.LFEOnly",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Sel="Sel",e.ReturnReverb="ReturnReverb",e.ReturnDelay="ReturnDelay",e.ReturnFx1="ReturnFx1",e.ReturnFx2="ReturnFx2",e.Monitor="Monitor",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(s||(s={})),function(e){e.EQChannelCellOn="EQ.channel[channel].cell[cell].on",e.EQChannelCellType="EQ.channel[channel].cell[cell].type",e.EQChannelCellF="EQ.channel[channel].cell[cell].f",e.EQChannelCellGain="EQ.channel[channel].cell[cell].gain",e.EQChannelCellQ="EQ.channel[channel].cell[cell].q"}(l||(l={})),function(e){e.Shutdown="Shutdown",e.Show="Show",e.Restart="Restart",e.Eject="Eject",e.Reset="Reset",e.Save="Save",e.Load="Load",e.DialogShowVBANCHAT="DialogShow.VBANCHAT"}(c||(c={})),function(e){e.LoadBUSEQ="LoadBUSEQ[bus]",e.SaveBUSEQ="SaveBUSEQ[bus]"}(u||(u={})),function(e){e.ButtonState="Button[button].State",e.ButtonStateOnly="Button[button].StateOnly",e.ButtonTrigger="Button[button].Trigger"}(h||(h={})),function(e){e.ReverbOn="Reverb.On",e.ReverbAB="Reverb.AB",e.DelayOn="Delay.On",e.DelayAB="Delay.AB"}(p||(p={})),function(e){e.PostFaderComposite="PostFaderComposite",e.PostFxInsert="PostFxInsert"}(m||(m={})),function(e){e.Asio="asio[channel]",e.OutA2="OutA2[channel]",e.OutA3="OutA3[channel]",e.OutA4="OutA4[channel]",e.OutA5="OutA5[channel]"}(P||(P={})),(d||(d={})).Composite="composite[channel]",(B||(B={})).Insert="insert[channel]",function(e){e.SR="sr",e.ASIOSR="ASIOsr",e.BufferMME="buffer.mme",e.BufferWDM="buffer.wdm",e.BufferKS="buffer.ks",e.BufferASIO="buffer.asio",e.ModeExclusif="mode.exclusif",e.ModeSwift="mode.swift",e.MonitorOnSEL="MonitorOnSEL"}(g||(g={})),(f||(f={})).Delay="delay[bus]",C||(C={}),y||(y={});var M={__proto__:null,InterfaceTypes:{strip:0,bus:1},get Replacers(){return n},get StripProperties(){return i},get StripGainLayerProperties(){return o},get StripAppProperties(){return a},get BusProperties(){return s},get BusEQChannelCellProperties(){return l},get CommandProperties(){return c},get CommandBusEQProperties(){return u},get CommandButtonProperties(){return h},get FXProperties(){return p},get PatchProperties(){return m},get PatchChannelProperties(){return P},get PatchCompositeProperties(){return d},get PatchInsertProperties(){return B},get SystemProperties(){return g},get SystemBusDelayProperties(){return f},get RecorderProperties(){return C},get VBANProperties(){return y}};const V=t("char"),v=t("long"),S=t("float");let w,A;class R{constructor(){this.isInitialised=!1,this.isConnected=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.eventPool=[],this.connect=()=>{if(!this.isInitialised)throw new Error("Await the initialisation before connect");if(!this.isConnected){if(0===w.VBVMR_Login())return this.isConnected=!0,this.type=this.getVoicemeeterType(),this.version=this.getVoicemeeterVersion(),void setInterval(this.checkPropertyChange,10);throw this.isConnected=!1,new Error("Connection failed")}},this.disconnect=()=>{if(!this.isConnected)throw new Error("Not connected ");try{if(0===w.VBVMR_Logout())return void(this.isConnected=!1);throw new Error("Disconnect failed")}catch(e){throw new Error("Disconnect failed")}},this.updateDeviceList=()=>{if(!this.isConnected)throw new Error("Not connected ");this.outputDevices=[],this.inputDevices=[];const e=w.VBVMR_Output_GetDeviceNumber();for(let t=0;t<e;t++){const e=new V(256),r=new V(256),n=new v(1);w.VBVMR_Output_GetDeviceDescA(t,n,r,e),this.outputDevices.push({name:String.fromCharCode(...r.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode(...e.toArray()).replace(/\u0000+$/g,""),type:n[0]})}const t=w.VBVMR_Input_GetDeviceNumber();for(let e=0;e<t;e++){const t=new V(256),r=new V(256),n=new v(1);w.VBVMR_Input_GetDeviceDescA(e,n,r,t),this.inputDevices.push({name:String.fromCharCode(...r.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode(...t.toArray()).replace(/\u0000+$/g,""),type:n[0]})}},this.isParametersDirty=()=>w.VBVMR_IsParametersDirty(),this.getStripParameter=(e,t)=>this.getParameter("Strip",e,t),this.setStripParameter=(e,t,r)=>this.setParameter("Strip",e,t,r),this.getBusParameter=(e,t)=>this.getParameter("Bus",e,t),this.setBusParameter=(e,t,r)=>this.setParameter("Bus",e,t,r),this.getStripGainLayerParameter=(e,t)=>{const r=o.GainLayer.replace(n.Bus,`[${t}]`);return this.getParameter("Strip",e,r)},this.setStripGainLayerParameter=(e,t,r)=>{const i=o.GainLayer.replace(n.Bus,`[${t}]`);return this.setParameter("Strip",e,i,r)},this.setStripAppParameter=(e,t,r,i)=>(t.includes("[")?t=t.replace(n.App,`[${r}]`):i=`("${r}",${i})`,this.setParameter("Strip",e,t,i)),this.getBusEQChannelCellParameter=(e,t,r,i)=>(i=(i=i.replace(n.Channel,`[${t}]`)).replace(n.Cell,`[${r}]`),this.getParameter("Bus",e,i)),this.setBusEQChannelCellParameter=(e,t,r,i,o)=>(i=(i=i.replace(n.Channel,`[${t}]`)).replace(n.Cell,`[${r}]`),this.setParameter("Bus",e,i,o)),this.getFXParameter=e=>this.getParameter("Fx",null,e),this.setFXParameter=(e,t)=>this.setParameter("Fx",null,e,t),this.getPatchParameter=e=>this.getParameter("Patch",null,e),this.setPatchParamater=(e,t)=>this.setParameter("Patch",null,e,t),this.getPatchChannelParameter=(e,t)=>(t=t.replace(n.Channel,`[${e}]`),this.getParameter("patch",null,t)),this.setPatchChannelParamater=(e,t,r)=>(t=t.replace(n.Channel,`[${e}]`),this.setParameter("patch",null,t,r)),this.getSystemParameter=e=>this.getParameter("Option",null,e),this.setSystemParameter=(e,t)=>this.setParameter("Option",null,e,t),this.getSystemBusDelayParameter=(e,t)=>(t=t.replace(n.Bus,`[${e}]`),this.getParameter("Option",null,t)),this.setSystemBusDelayParameter=(e,t,r)=>(t=t.replace(n.Bus,`[${e}]`),this.setParameter("Option",null,t,r)),this.setCommandParameter=(e,t)=>{if(!this.isConnected)throw new Error("Not connected ");const r=`Command.${e}=${t};`,n=Buffer.alloc(r.length+1);return n.fill(0),n.write(r),w.VBVMR_SetParameters(n),new Promise(e=>setTimeout(e,200))},this.setCommandBusEQParamater=(e,t,r)=>{if(!this.isConnected)throw new Error("Not connected ");const i=`Command.${t=t.replace(n.Bus,`[${e}]`)}=${r};`,o=Buffer.alloc(i.length+1);return o.fill(0),o.write(i),w.VBVMR_SetParameters(o),new Promise(e=>setTimeout(e,200))},this.setCommandButtonParameter=(e,t,r)=>{if(!this.isConnected)throw new Error("Not connected ");const i=`Command.${t=t.replace(n.Button,`[${e}]`)}=${r};`,o=Buffer.alloc(i.length+1);return o.fill(0),o.write(i),w.VBVMR_SetParameters(o),new Promise(e=>setTimeout(e,200))},this.attachChangeEvent=e=>{this.eventPool.push(e)},this.checkPropertyChange=()=>{1===this.isParametersDirty()&&this.eventPool.forEach(e=>{e()})},this.getVoicemeeterType=()=>{const e=new v(1);if(0!==w.VBVMR_GetVoicemeeterType(e))throw new Error("running failed");switch(e[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=()=>{const e=new v(1);if(0!==w.VBVMR_GetVoicemeeterVersion(e))throw new Error("running failed");return e},this.getParameter=(e,t,r)=>{const n=null!==t?`${e}[${t}].${r}`:`${e}.${r}`;if(!this.isConnected)throw new Error("Not correct connected ");const i=Buffer.alloc(n.length+1);i.write(n);let o=null;return["Label","FadeTo","FadeBy","AppGain","AppMute","device.name"].indexOf(r)>-1?(o=new V(512),w.VBVMR_GetParameterStringA(i,o),String.fromCharCode.apply(null,o).split("").filter(e=>"\0"!==e).join("")):(o=new S(1),w.VBVMR_GetParameterFloat(i,o),o[0])},this.setParameter=(e,t,r,n)=>{if(!this.isConnected)throw new Error("Not connected ");const i=null!==t?`${e}[${t}].${r}=${n};`:`${e}.${r}=${n};`,o=Buffer.alloc(i.length+1);return o.fill(0),o.write(i),w.VBVMR_SetParameters(o),new Promise(e=>setTimeout(e,200))}}static async init(){const t=await(async()=>{const e=new r({hive:r.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return new Promise(t=>{e.values((e,r)=>{if(e)throw new Error(e);const n=r.find(e=>"UninstallString"===e.name).value,i=n.lastIndexOf("\\");t(n.slice(0,i))})})})();return new Promise(r=>{A||(A=new R),w=e.Library(`${t}/VoicemeeterRemote64.dll`,{VBVMR_Login:["long",[]],VBVMR_Logout:["long",[]],VBVMR_RunVoicemeeter:["long",["long"]],VBVMR_IsParametersDirty:["long",[]],VBVMR_GetParameterFloat:["long",[V,S]],VBVMR_GetParameterStringA:["long",[V,V]],VBVMR_SetParameters:["long",[V]],VBVMR_Output_GetDeviceNumber:["long",[]],VBVMR_Output_GetDeviceDescA:["long",["long",v,V,V]],VBVMR_Input_GetDeviceNumber:["long",[]],VBVMR_Input_GetDeviceDescA:["long",["long",v,V,V]],VBVMR_GetVoicemeeterType:["long",[v]],VBVMR_GetVoicemeeterVersion:["long",[v]]}),A.isInitialised=!0,r(A)})}get $outputDevices(){return this.outputDevices}get $inputDevices(){return this.inputDevices}get $version(){return this.version}get $type(){return this.type}}var D={__proto__:null};const{InterfaceTypes:E,StripProperties:_,BusProperties:x,BusEQChannelCellProperties:$,FXProperties:G,CommandProperties:b,PatchProperties:F,PatchChannelProperties:O,PatchCompositeProperties:Q,PatchInsertProperties:L,SystemProperties:I,SystemBusDelayProperties:T,RecorderProperties:N,VBANProperties:U}=M;export{$ as BusEQChannelCellProperties,x as BusProperties,b as CommandProperties,G as FXProperties,E as InterfaceTypes,O as PatchChannelProperties,Q as PatchCompositeProperties,L as PatchInsertProperties,F as PatchProperties,N as RecorderProperties,_ as StripProperties,T as SystemBusDelayProperties,I as SystemProperties,U as VBANProperties,R as Voicemeeter,D as types};
//# sourceMappingURL=index.modern.js.map
